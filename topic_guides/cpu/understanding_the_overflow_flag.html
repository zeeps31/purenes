<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="prev" title="Central Processing Unit (CPU)" href="../cpu.html" />

    <meta name="generator" content="sphinx-4.5.0, furo 2022.03.04"/>
        <title>Understanding the Overflow Flag - PureNES 0.33.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=935aa2abcc5c1da4283d1dc201fb1f0add16d23a" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=25ceb02ed1c46dc30f2321ff83e92799f69dfdb9" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">PureNES 0.33.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">PureNES 0.33.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../topic_guides.html">Topic Guides</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../ppu.html">Picture Processing Unit (PPU)</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../ppu/fetching_an_attribute_table_byte_during_rendering.html">Fetching Attribute Table Bytes During Rendering</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="../cpu.html">Central Processing Unit (CPU)</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Understanding the Overflow Flag</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container"><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="understanding-the-overflow-flag">
<h1>Understanding the Overflow Flag<a class="headerlink" href="#understanding-the-overflow-flag" title="Permalink to this headline">#</a></h1>
<p>This topic guide attempts to provide details about the overflow flag that are
not available in existing resources on the subject.</p>
<p><strong>Prerequisites</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.masswerk.at/6502/6502_instruction_set.html#ADC">ADC Operation</a></p></li>
<li><p><a class="reference external" href="https://www.masswerk.at/6502/6502_instruction_set.html#SBC">SBC Operation</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Two%27s_complement">Two’s Complement</a></p></li>
</ul>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">#</a></h2>
<p>A value is considered “signed” if it can represent both positive and negative
numbers (has a sign +-) and “unsigned” if it can only represent positive
integer values (does not have a sign). Recall that bytes stored in memory are
just bytes: they are neither signed nor unsigned. The CPU, therefore, does not
interpret values as signed or unsigned when performing an operation, but
exposes a set of flags that help the program interpret the result as signed or
unsigned. One of these flags is the “overflow” flag (V). The overflow flag is
only applicable to signed values and is set when an addition or subtraction
operation performed on two values of the same sign results in a value of the
opposite sign.</p>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">#</a></h2>
<div class="table-wrapper"><table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 14%"/>
<col style="width: 14%"/>
<col style="width: 29%"/>
<col style="width: 14%"/>
<col style="width: 14%"/>
<col style="width: 14%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Accumulator Value</p></th>
<th class="head"><p>Operation Value</p></th>
<th class="head"><p>Operation</p></th>
<th class="head"><p>Unsigned Result</p></th>
<th class="head"><p>Signed Result</p></th>
<th class="head"><p>Overflow</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0x7F (127)</p></td>
<td><p>0x01 (1)</p></td>
<td><p>127 + 1 (0x7F + 0x01)</p></td>
<td><p>0x80 (128)</p></td>
<td><p>0x80 (-128)</p></td>
<td><p>True</p></td>
</tr>
<tr class="row-odd"><td><p>0xFE (-2)</p></td>
<td><p>0x7F (127)</p></td>
<td><p>-2 - 127 (0xFE + 0x81)</p></td>
<td><p>0x7F (127)</p></td>
<td><p>0x7F (127)</p></td>
<td><p>True</p></td>
</tr>
</tbody>
</table></div>
<p><strong>Example 1 Description:</strong></p>
<p>Overflow has occurred because both of the input values 127 and 1 have the same
sign, but the result of the operation has a different sign (-128) and is
incorrect. The diagram below shows ordered hexadecimal values and the
corresponding signed value in decimal. The signed range for an 8-bit value is
(-128, 127). Adding 1 to 127 (0x7F) causes the result to exceed the maximum
positive signed value, thereby “overflowing” into the negative range.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mh">0x00</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="o">...</span>
<span class="mh">0x7F</span> <span class="p">(</span> <span class="mi">127</span><span class="p">)</span>  <span class="p">(</span><span class="mh">0x7F</span> <span class="o">+</span> <span class="mh">0x01</span><span class="p">)</span>
<span class="mh">0x80</span> <span class="p">(</span><span class="o">-</span><span class="mi">128</span><span class="p">)</span>  <span class="o">&lt;-----|</span>
<span class="mh">0x81</span> <span class="p">(</span><span class="o">-</span><span class="mi">127</span><span class="p">)</span>
<span class="o">...</span>
<span class="mh">0xFF</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Example 2 Description:</strong></p>
<p>Example 2 is slightly more complicated as it deals with subtraction. Note that
the values for the operation seem to contradict the overflow requirement of the
values having the same sign:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">127</span> <span class="o">=</span> <span class="mi">127</span> <span class="p">(</span><span class="n">result</span> <span class="n">should</span> <span class="n">be</span> <span class="o">-</span><span class="mi">129</span><span class="p">)</span>
<span class="p">(</span><span class="o">-</span><span class="p">)</span>  <span class="p">(</span><span class="o">+</span><span class="p">)</span>   <span class="p">(</span><span class="o">+</span><span class="p">)</span>
</pre></div>
</div>
<p>This is not the case, however, based on the way in which the CPU performs
subtraction. The CPU performs subtraction operations by negating the operation
value and adding it to the accumulator. The same problem can be rewritten as
follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="mi">2</span> <span class="o">+</span> <span class="o">-</span><span class="mi">127</span> <span class="o">=</span> <span class="mi">127</span> <span class="p">(</span><span class="n">result</span> <span class="n">should</span> <span class="n">be</span> <span class="o">-</span><span class="mi">129</span><span class="p">)</span>
<span class="p">(</span><span class="o">-</span><span class="p">)</span>   <span class="p">(</span><span class="o">-</span><span class="p">)</span>   <span class="p">(</span><span class="o">+</span><span class="p">)</span>
     <span class="ow">or</span>
<span class="mh">0xFE</span> <span class="o">+</span> <span class="mh">0x81</span>
</pre></div>
</div>
<p>When the problem is rewritten in this way the condition holds, as the sign of
both values are the same and the result has a different sign. The result is 127
because there are 128 negative values in the signed range of an 8-bit integer.
Adding -2 to -127 (-127 + -2 = -129) exceeds the range by 1, so the result is
127. This is explained further in the example below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mh">0x00</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="o">&lt;---*</span>
<span class="mh">0x01</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>      <span class="o">|</span>
<span class="o">...</span>           <span class="o">|</span>
<span class="mh">0x7F</span> <span class="p">(</span> <span class="mi">127</span><span class="p">)</span>   <span class="o">|</span> <span class="o">*</span> <span class="n">Final</span> <span class="n">result</span><span class="o">.</span> <span class="n">The</span> <span class="n">result</span> <span class="n">has</span> <span class="n">exceeded</span> <span class="n">the</span> <span class="nb">max</span> <span class="n">by</span> <span class="mf">1.</span>
<span class="mh">0x80</span> <span class="p">(</span><span class="o">-</span><span class="mi">128</span><span class="p">)</span>   <span class="o">|</span>
<span class="mh">0x81</span> <span class="p">(</span><span class="o">-</span><span class="mi">127</span><span class="p">)</span>   <span class="o">|</span>
<span class="o">...</span>           <span class="o">|</span>
<span class="mh">0xFE</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>     <span class="o">|</span> <span class="o">*</span> <span class="n">Starts</span> <span class="n">here</span> <span class="ow">and</span> <span class="n">adds</span> <span class="mh">0x81</span> <span class="p">(</span><span class="mi">127</span><span class="p">)</span>
<span class="mh">0xFF</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">----*</span> <span class="o">*</span> <span class="n">The</span> <span class="n">result</span> <span class="s2">"wraps around"</span> <span class="n">when</span> <span class="n">it</span> <span class="n">reaches</span> <span class="n">the</span> <span class="n">maximum</span> <span class="n">value</span>
                  <span class="k">for</span> <span class="n">the</span> <span class="mi">8</span><span class="o">-</span><span class="n">bit</span> <span class="nb">range</span><span class="o">.</span> <span class="n">Once</span> <span class="n">it</span> <span class="n">gets</span> <span class="n">to</span> <span class="n">this</span> <span class="n">point</span> <span class="n">there</span> <span class="n">are</span>
                  <span class="n">still</span> <span class="mi">127</span> <span class="n">values</span> <span class="n">to</span> <span class="n">go</span> <span class="p">(</span><span class="mh">0xFF</span> <span class="o">-</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">=</span> <span class="mf">127.</span>
</pre></div>
</div>
</section>
<section id="why-values-of-the-opposite-sign-cannot-overflow">
<h2>Why Values of the Opposite Sign Cannot Overflow<a class="headerlink" href="#why-values-of-the-opposite-sign-cannot-overflow" title="Permalink to this headline">#</a></h2>
<p>An overflow can never occur when the operands are of opposite sign since the
result will never exceed this range. The rationale behind this is quite simple,
but might not be readily apparent at first glance. Recall that the range for
signed values is (-128, 127).</p>
<p>During addition, if the maximum of each range is added the result will be -1
(0xFF).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="mi">128</span> <span class="o">+</span> <span class="mi">127</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
<p>During subtraction, if the the maximum of each range is subtracted the result
will be -1 (0xFF).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">127</span> <span class="o">-</span> <span class="mi">128</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
<p>It might be tempting to think that the example above should be constructed like
the examples below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">127</span> <span class="o">-</span> <span class="o">-</span><span class="mi">128</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="p">(</span><span class="n">should</span> <span class="n">be</span> <span class="mi">255</span><span class="p">)</span>
    <span class="ow">or</span>
<span class="o">-</span><span class="mi">128</span> <span class="o">-</span> <span class="mi">127</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">(</span><span class="n">should</span> <span class="n">be</span> <span class="o">-</span><span class="mi">255</span><span class="p">)</span>
</pre></div>
</div>
<p>But recall that the CPU will actually calculate the problem as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="mi">127</span> <span class="o">-</span> <span class="o">-</span><span class="mi">128</span> <span class="o">-&gt;</span>  <span class="mi">127</span> <span class="o">+</span> <span class="mi">128</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="p">(</span><span class="n">should</span> <span class="n">be</span> <span class="mi">255</span><span class="p">)</span>
                <span class="p">(</span><span class="o">+</span><span class="p">)</span>   <span class="p">(</span><span class="o">+</span><span class="p">)</span>   <span class="p">(</span><span class="o">-</span><span class="p">)</span>
     <span class="ow">or</span>

<span class="o">-</span><span class="mi">128</span> <span class="o">-</span>  <span class="mi">127</span> <span class="o">-&gt;</span> <span class="o">-</span><span class="mi">128</span> <span class="o">+</span> <span class="o">-</span><span class="mi">127</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">(</span><span class="n">should</span> <span class="n">be</span> <span class="o">-</span><span class="mi">255</span><span class="p">)</span>
                <span class="p">(</span><span class="o">-</span><span class="p">)</span>    <span class="p">(</span><span class="o">-</span><span class="p">)</span>  <span class="p">(</span><span class="o">+</span><span class="p">)</span>
</pre></div>
</div>
<p>Under these circumstances the signs are actually the same and overflow occurs.</p>
</section>
<section id="understanding-overflow-detection-implementation-in-purenes">
<h2>Understanding Overflow Detection Implementation in PureNES<a class="headerlink" href="#understanding-overflow-detection-implementation-in-purenes" title="Permalink to this headline">#</a></h2>
<p>PureNES performs two checks to determine if the overflow flag should be set.</p>
<p><strong>1. The input signs are the same:</strong></p>
<p>The sign of an 8-bit value is determined by the most significant bit (MSB) in
the value. As see below, the highest order bit is set to 1 when a value is
negative in its two’s complement representation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mh">0x01</span> <span class="p">(</span> <span class="mi">1</span><span class="p">)</span>   <span class="o">=</span> <span class="mi">00000001</span>
<span class="o">...</span>
<span class="mh">0x7F</span> <span class="p">(</span> <span class="mi">127</span><span class="p">)</span> <span class="o">=</span> <span class="mi">01111111</span>
<span class="mh">0x80</span> <span class="p">(</span><span class="o">-</span><span class="mi">128</span><span class="p">)</span> <span class="o">=</span> <span class="mi">10000000</span> <span class="o">*</span> <span class="n">For</span> <span class="nb">all</span> <span class="n">negative</span> <span class="n">values</span><span class="p">,</span> <span class="n">the</span> <span class="n">MSB</span> <span class="ow">is</span> <span class="nb">set</span> <span class="n">to</span> <span class="mi">1</span>
<span class="mh">0x81</span> <span class="p">(</span><span class="o">-</span><span class="mi">127</span><span class="p">)</span> <span class="o">=</span> <span class="mi">10000001</span>
<span class="o">...</span>
<span class="mh">0xFE</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>   <span class="o">=</span> <span class="mi">11111110</span>
<span class="mh">0xFF</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>   <span class="o">=</span> <span class="mi">11111111</span>
</pre></div>
</div>
<p>For values that have the same sign, the MSB in each value should
be the same. This can be calculated using the negation of the exclusive or
(EOR) between two values. An EOR will only be true when either of the operands
are true (one is true and the other one is false) but both are not true and
both are not false. and is calculated as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ow">not</span> <span class="p">((</span><span class="n">x</span> <span class="o">^</span> <span class="n">y</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span>
</pre></div>
</div>
<p>This is broken down below</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">operation</span><span class="p">:</span> <span class="n">x</span> <span class="o">^</span> <span class="n">y</span>

<span class="n">x</span><span class="p">:</span>       <span class="mi">5</span> <span class="o">-&gt;</span> <span class="mi">00000101</span>
<span class="n">y</span><span class="p">:</span>       <span class="mi">6</span> <span class="o">-&gt;</span> <span class="mi">00000110</span>
<span class="n">EOR</span>      <span class="o">-------------</span>
<span class="n">value</span><span class="p">:</span>   <span class="mi">3</span> <span class="o">-&gt;</span> <span class="mi">00000011</span>

<span class="n">operation</span><span class="p">:</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0x80</span>

<span class="n">value</span><span class="p">:</span>    <span class="mi">3</span> <span class="o">-&gt;</span> <span class="mi">00000011</span>
<span class="n">mask</span><span class="p">:</span>   <span class="mi">128</span> <span class="o">-&gt;</span> <span class="mi">10000000</span> <span class="o">*</span> <span class="p">(</span><span class="n">mask</span> <span class="n">refers</span> <span class="n">to</span> <span class="mh">0x80</span><span class="p">)</span>
<span class="n">AND</span>     <span class="o">---------------</span>
<span class="n">result</span><span class="p">:</span>   <span class="mi">0</span> <span class="o">-&gt;</span> <span class="mi">00000000</span>

<span class="n">Finding</span> <span class="n">the</span> <span class="n">EOR</span> <span class="k">as</span> <span class="n">shown</span> <span class="n">above</span> <span class="n">will</span> <span class="n">only</span> <span class="n">determine</span> <span class="k">if</span> <span class="n">the</span> <span class="n">signs</span> <span class="n">are</span> <span class="n">NOT</span>
<span class="n">the</span> <span class="n">same</span><span class="p">,</span> <span class="n">so</span> <span class="n">the</span> <span class="n">opposite</span> <span class="n">must</span> <span class="n">be</span> <span class="n">used</span> <span class="n">to</span> <span class="n">determine</span> <span class="k">if</span> <span class="n">the</span> <span class="n">signs</span> <span class="n">are</span> <span class="n">the</span>
<span class="n">same</span><span class="o">.</span>

<span class="ow">not</span> <span class="mi">00000000</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">Therefore</span> <span class="n">these</span> <span class="n">two</span> <span class="n">values</span> <span class="n">have</span> <span class="n">the</span> <span class="n">same</span> <span class="n">sign</span><span class="o">.</span>
</pre></div>
</div>
<p><strong>2. The input and result signs differ:</strong></p>
<p>The same logic in the first condition can easily be applied to the second
condition.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="n">x</span> <span class="o">^</span> <span class="n">result</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>This is broken down below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">operation</span><span class="p">:</span> <span class="n">x</span> <span class="o">^</span> <span class="n">result</span>

<span class="n">x</span><span class="p">:</span>        <span class="mi">5</span> <span class="o">-&gt;</span> <span class="mi">00000101</span>
<span class="n">result</span><span class="p">:</span>  <span class="mi">11</span> <span class="o">-&gt;</span> <span class="mi">00001011</span>
<span class="n">EOR</span>      <span class="o">---------------</span>
<span class="n">value</span><span class="p">:</span>   <span class="mi">14</span>    <span class="mi">00001110</span>

<span class="n">operation</span><span class="p">:</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0x80</span>

<span class="n">value</span><span class="p">:</span>   <span class="mi">14</span> <span class="o">-&gt;</span> <span class="mi">00001110</span>
<span class="n">mask</span><span class="p">:</span>   <span class="mi">128</span> <span class="o">-&gt;</span> <span class="mi">10000000</span> <span class="o">*</span> <span class="p">(</span><span class="n">mask</span> <span class="n">refers</span> <span class="n">to</span> <span class="mh">0x80</span><span class="p">)</span>
<span class="n">AND</span>     <span class="o">---------------</span>
<span class="n">value</span><span class="p">:</span>    <span class="mi">0</span>    <span class="mi">00000000</span>

<span class="ow">not</span> <span class="mi">0</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">Therefore</span> <span class="n">the</span> <span class="nb">input</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">result</span> <span class="n">signs</span> <span class="n">do</span> <span class="ow">not</span> <span class="n">differ</span><span class="o">.</span>
</pre></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          <a class="prev-page" href="../cpu.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Central Processing Unit (CPU)</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Stephen Brady
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Understanding the Overflow Flag</a><ul>
<li><a class="reference internal" href="#background">Background</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
<li><a class="reference internal" href="#why-values-of-the-opposite-sign-cannot-overflow">Why Values of the Opposite Sign Cannot Overflow</a></li>
<li><a class="reference internal" href="#understanding-overflow-detection-implementation-in-purenes">Understanding Overflow Detection Implementation in PureNES</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    </body>
</html>